<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLE7 Rock Cloud - Final Edition</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        :root { --glass: rgba(255, 255, 255, 0.4); --bg: radial-gradient(circle at top left, #4facfe 0%, #00f2fe 100%); }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); background-attachment: fixed; margin: 0; padding: 20px; display: flex; justify-content: center; color: #003366; }
        .container { width: 100%; max-width: 900px; background: var(--glass); backdrop-filter: blur(25px); border-radius: 30px; border: 1px solid rgba(255, 255, 255, 0.5); padding: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.2); }
        
        /* –ö–Ω–æ–ø–∫–∏ –≤ —Å—Ç–∏–ª–µ Aero */
        .btn { background: linear-gradient(to bottom, #ffffff 0%, #cedbe9 100%); color: #003366; border: 1px solid #707070; padding: 10px 20px; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,168,255,0.3); }
        .btn-main { background: linear-gradient(to bottom, #87e8fb 0%, #1ea1d7 100%); color: white; border-color: #1e70a1; }
        .btn-danger { background: linear-gradient(to bottom, #ff9999 0%, #cc0000 100%); color: white; border-color: #990000; }

        .hidden { display: none !important; }
        input, textarea { width: 100%; background: rgba(255,255,255,0.8); border: 1px solid #ccc; padding: 12px; border-radius: 10px; margin-bottom: 10px; box-sizing: border-box; font-size: 14px; }
        
        .band-card { background: rgba(255,255,255,0.5); padding: 15px; border-radius: 15px; margin-bottom: 10px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; border: 1px solid white; transition: 0.3s; }
        .band-card:hover { background: white; transform: translateX(5px); }

        /* –í–∫–ª–∞–¥–∫–∏ */
        .tabs { display: flex; gap: 5px; margin: 20px 0; }
        .tab { padding: 10px 20px; cursor: pointer; background: rgba(255,255,255,0.2); border-radius: 10px 10px 0 0; border: 1px solid rgba(255,255,255,0.2); }
        .tab.active { background: white; font-weight: bold; border-bottom: none; }

        .header-flex { display: flex; gap: 20px; align-items: center; margin-top: 20px; }
        #v-img-main { width: 180px; height: 180px; border-radius: 20px; object-fit: contain; background: #fff; border: 5px solid white; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .view-area { background: rgba(255,255,255,0.6); padding: 25px; border-radius: 25px; line-height: 1.6; white-space: pre-wrap; min-height: 200px; border: 1px solid white; }
        
        .gallery-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .gal-card { background: white; padding: 10px; border-radius: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .gal-card img { width: 100%; height: 200px; object-fit: contain; border-radius: 10px; background: #f9f9f9; }
    </style>
</head>
<body>

<div class="container">
    <div id="screen-list">
        <h1 style="text-align:center; color: white; text-shadow: 0 2px 5px rgba(0,0,0,0.2);">üåä PLE7 ROCK CLOUD</h1>
        <div style="text-align:center; margin-bottom: 25px;">
            <button class="btn btn-main" onclick="openNewEditor()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤ –∞—Ä—Ö–∏–≤</button>
        </div>
        <div id="bands-container">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –æ–±–ª–∞–∫–æ–º...</div>
    </div>

    <div id="screen-view" class="hidden">
        <div style="display:flex; justify-content: space-between; align-items: center;">
            <button class="btn" onclick="showScreen('screen-list')">‚Ü© –ù–∞–∑–∞–¥</button>
            <button class="btn btn-danger" id="delete-btn">üóë –£–¥–∞–ª–∏—Ç—å –≥—Ä—É–ø–ø—É</button>
        </div>
        <div class="header-flex">
            <img id="v-img-main" src="">
            <div style="flex:1">
                <h1 id="v-name" style="margin:0; color:#004488;"></h1>
                <p id="v-year" style="font-size: 1.1em; color: #555;"></p>
                <audio id="v-audio" controls style="width:100%; margin-top:10px;"></audio>
            </div>
        </div>
        <div class="tabs">
            <div class="tab active" onclick="switchTab('v-bio', this)">–ò—Å—Ç–æ—Ä–∏—è</div>
            <div class="tab" onclick="switchTab('v-disco', this)">–î–∏—Å–∫–æ–≥—Ä–∞—Ñ–∏—è</div>
            <div class="tab" onclick="switchTab('v-lyrics', this)">–¢–µ–∫—Å—Ç—ã</div>
            <div class="tab" onclick="switchTab('v-gal', this)">–ì–∞–ª–µ—Ä–µ—è</div>
        </div>
        <div id="v-bio" class="view-area tab-content"></div>
        <div id="v-disco" class="view-area tab-content hidden"></div>
        <div id="v-lyrics" class="view-area tab-content hidden"></div>
        <div id="v-gal" class="tab-content hidden"><div id="v-gallery-grid" class="gallery-grid"></div></div>
    </div>

    <div id="screen-edit" class="hidden">
        <h2 style="color:white; text-shadow: 0 1px 3px rgba(0,0,0,0.2);">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
            <div>
                <input type="text" id="e-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
                <input type="text" id="e-year" placeholder="–ì–æ–¥ –æ—Å–Ω–æ–≤–∞–Ω–∏—è / –ì–æ—Ä–æ–¥">
                <label>–ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ:</label><input type="file" onchange="encodeMedia(this, 'img')">
                <label>–ü–µ—Å–Ω—è (MP3):</label><input type="file" onchange="encodeMedia(this, 'audio')">
            </div>
            <div style="background:rgba(255,255,255,0.2); padding:15px; border-radius:15px; border: 1px solid white;">
                <label>–§–æ—Ç–æ –≥–∞–ª–µ—Ä–µ–∏ 1:</label><input type="file" onchange="encodeMedia(this, 'g1')">
                <input type="text" id="e-g1-t" placeholder="–ü–æ–¥–ø–∏—Å—å –∫ —Ñ–æ—Ç–æ 1">
                <label>–§–æ—Ç–æ –≥–∞–ª–µ—Ä–µ–∏ 2:</label><input type="file" onchange="encodeMedia(this, 'g2')">
                <input type="text" id="e-g2-t" placeholder="–ü–æ–¥–ø–∏—Å—å –∫ —Ñ–æ—Ç–æ 2">
            </div>
        </div>
        <textarea id="e-bio" rows="4" placeholder="–ë–∏–æ–≥—Ä–∞—Ñ–∏—è –≥—Ä—É–ø–ø—ã..."></textarea>
        <textarea id="e-disco" rows="2" placeholder="–°–ø–∏—Å–æ–∫ –∞–ª—å–±–æ–º–æ–≤..."></textarea>
        <textarea id="e-lyrics" rows="2" placeholder="–¢–µ–∫—Å—Ç—ã –ø–æ–ø—É–ª—è—Ä–Ω—ã—Ö –ø–µ—Å–µ–Ω..."></textarea>
        
        <button class="btn btn-main" style="width:100%; margin-top:10px; padding: 15px;" id="save-btn" onclick="saveData()">‚òÅ –°–û–•–†–ê–ù–ò–¢–¨ –í –û–ë–õ–ê–ö–û</button>
        <button class="btn" style="width:100%; margin-top:10px;" onclick="showScreen('screen-list')">–û—Ç–º–µ–Ω–∞</button>
    </div>
</div>

<script>
    // –¢–í–û–ò –î–ê–ù–ù–´–ï FIREBASE
    const firebaseConfig = {
        apiKey: "AIzaSyCCMz8l4I6c6TKTiR4jGsmIjrKtyQdWIno",
        authDomain: "ple7-edit-v1.firebaseapp.com",
        databaseURL: "https://ple7-edit-v1-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "ple7-edit-v1",
        storageBucket: "ple7-edit-v1.firebasestorage.app",
        messagingSenderId: "779852816376",
        appId: "1:779852816376:web:be6b45d7e2290f7192000d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let tempMedia = {};
    let currentBandId = null;

    function loadBands() {
        db.ref('bands').on('value', (snap) => {
            const container = document.getElementById('bands-container');
            container.innerHTML = "";
            const data = snap.val();
            if (!data) { container.innerHTML = "<p style='text-align:center; color:white;'>–û–±–ª–∞–∫–æ –ø—É—Å—Ç–æ. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –≥—Ä—É–ø–ø—É!</p>"; return; }
            for (let id in data) {
                let card = document.createElement('div');
                card.className = 'band-card';
                card.innerHTML = `<b>${data[id].name}</b> <span>‚ñ∂</span>`;
                card.onclick = () => showBand(id, data[id]);
                container.appendChild(card);
            }
        });
    }

    function encodeMedia(input, key) {
        if (!input.files[0]) return;
        const reader = new FileReader();
        reader.onloadend = () => tempMedia[key] = reader.result;
        reader.readAsDataURL(input.files[0]);
    }

    function saveData() {
        const name = document.getElementById('e-name').value;
        if (!name) return alert("–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã!");
        
        const btn = document.getElementById('save-btn');
        btn.disabled = true; btn.innerText = "–ó–∞–≥—Ä—É–∑–∫–∞ –≤ –æ–±–ª–∞–∫–æ...";

        const bandData = {
            name: name,
            year: document.getElementById('e-year').value,
            bio: document.getElementById('e-bio').value,
            disco: document.getElementById('e-disco').value,
            lyrics: document.getElementById('e-lyrics').value,
            img: tempMedia.img || "",
            audio: tempMedia.audio || "",
            g1: tempMedia.g1 || "", g1t: document.getElementById('e-g1-t').value,
            g2: tempMedia.g2 || "", g2t: document.getElementById('e-g2-t').value
        };

        db.ref('bands').push(bandData).then(() => {
            btn.disabled = false; btn.innerText = "‚òÅ –°–û–•–†–ê–ù–ò–¢–¨ –í –û–ë–õ–ê–ö–û";
            showScreen('screen-list');
            tempMedia = {};
        });
    }

    function showBand(id, data) {
        currentBandId = id;
        document.getElementById('v-name').innerText = data.name;
        document.getElementById('v-year').innerText = data.year || "";
        document.getElementById('v-bio').innerText = data.bio || "–ë–∏–æ–≥—Ä–∞—Ñ–∏—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞.";
        document.getElementById('v-disco').innerText = data.disco || "–°–ø–∏—Å–æ–∫ –∞–ª—å–±–æ–º–æ–≤ –ø—É—Å—Ç.";
        document.getElementById('v-lyrics').innerText = data.lyrics || "–¢–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç.";
        document.getElementById('v-img-main').src = data.img || "";
        document.getElementById('v-audio').src = data.audio || "";
        
        const grid = document.getElementById('v-gallery-grid');
        grid.innerHTML = "";
        if(data.g1) grid.innerHTML += `<div class="gal-card"><img src="${data.g1}"><p>${data.g1t || ""}</p></div>`;
        if(data.g2) grid.innerHTML += `<div class="gal-card"><img src="${data.g2}"><p>${data.g2t || ""}</p></div>`;
        
        document.getElementById('delete-btn').onclick = () => deleteThisBand(id);
        showScreen('screen-view');
        switchTab('v-bio', document.querySelector('.tab'));
    }

    function deleteThisBand(id) {
        if (confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –≥—Ä—É–ø–ø—É –∏–∑ –æ–±–ª–∞—á–Ω–æ–≥–æ –∞—Ä—Ö–∏–≤–∞ –Ω–∞–≤—Å–µ–≥–¥–∞?")) {
            db.ref('bands/' + id).remove().then(() => showScreen('screen-list'));
        }
    }

    function openNewEditor() {
        tempMedia = {};
        document.querySelectorAll('#screen-edit input, #screen-edit textarea').forEach(i => i.value = "");
        showScreen('screen-edit');
    }

    function showScreen(id) {
        document.querySelectorAll('.container > div').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        window.scrollTo(0,0);
    }

    function switchTab(id, el) {
        document.querySelectorAll('.tab-content').forEach(c => c.classList.add('hidden'));
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById(id).classList.remove('hidden');
        el.classList.add('active');
    }

    loadBands();
</script>
</body>
</html>
